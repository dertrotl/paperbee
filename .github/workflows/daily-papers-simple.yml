# .github/workflows/daily-papers.yml
name: Daily Paper Fetch (Gemini Fork)

on:
  schedule:
    - cron: '0 9 * * *'  # Daily at 9 AM UTC
  workflow_dispatch:

jobs:
  fetch-papers:
    runs-on: ubuntu-latest
    timeout-minutes: 15
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          
      - name: Install dependencies
        run: |
          pip install -e .  # Install your modified fork (NOT the PyPI package)
          
      - name: Create Google credentials file
        run: |
          echo '${{ secrets.GOOGLE_CREDENTIALS_JSON }}' > google-credentials.json
          
      - name: Create config file
        run: |
          cat > config.yml << 'EOF'
          GOOGLE_SPREADSHEET_ID: "${{ secrets.GOOGLE_SPREADSHEET_ID }}"
          GOOGLE_CREDENTIALS_JSON: "./google-credentials.json"
          NCBI_API_KEY: "${{ secrets.NCBI_API_KEY }}"
          LOCAL_ROOT_DIR: "."
          
          # Your research focus - customize this!
          query: "${{ secrets.SEARCH_QUERY || '[machine learning] OR [artificial intelligence] OR [deep learning]' }}"
          
          # LLM Filtering with Gemini (your modified version supports this!)
          LLM_FILTERING: true
          LLM_PROVIDER: "openai"
          LANGUAGE_MODEL: "gemini-1.5-flash"
          OPENAI_API_KEY: "${{ secrets.GEMINI_API_KEY }}"
          OPENAI_BASE_URL: "https://generativelanguage.googleapis.com/v1beta/openai/"
          
          FILTERING_PROMPT: "${{ secrets.FILTERING_PROMPT || 'You are a research assistant. Is this paper relevant to machine learning/AI research? Answer only yes or no.' }}"
          
          SLACK:
            is_posting_on: true
            bot_token: "${{ secrets.SLACK_BOT_TOKEN }}"
            channel_id: "${{ secrets.SLACK_CHANNEL_ID }}"
            app_token: "${{ secrets.SLACK_APP_TOKEN }}"
          
          TELEGRAM:
            is_posting_on: false
          ZULIP:
            is_posting_on: false
          EOF
          
      - name: Debug config file
        run: |
          echo "=== Config file contents ==="
          cat config.yml
          echo "=== End config file ==="
          
      - name: Run PaperBee (your modified fork)
        run: |
          paperbee post --config config.yml --since 1
          
      - name: Clean up
        if: always()
        run: |
          rm -f google-credentials.json config.yml
